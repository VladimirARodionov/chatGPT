# Dockerfile для Telegram Bot API Server
FROM ubuntu:22.04

# Установка необходимых зависимостей
RUN apt-get update && \
    apt-get install -y \
    build-essential \
    cmake \
    gperf \
    git \
    libssl-dev \
    zlib1g-dev \
    ninja-build \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Клонирование репозитория telegram-bot-api
WORKDIR /src
RUN git clone --recursive https://github.com/tdlib/telegram-bot-api.git

# Сборка telegram-bot-api
WORKDIR /src/telegram-bot-api
RUN mkdir build && \
    cd build && \
    cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX:PATH=/usr/local .. && \
    cmake --build . --target install

# Создание рабочей директории
WORKDIR /app

# Копирование скрипта запуска
COPY start_bot_api.sh /app/start_bot_api.sh
RUN chmod +x /app/start_bot_api.sh

# Установка переменной окружения для настройки API сервера
#ENV API_ID=""
#ENV API_HASH=""
#ENV API_PORT=8082

# Открытие порта
EXPOSE 8082

# Запуск telegram-bot-api сервера
CMD ["/app/start_bot_api.sh"] 